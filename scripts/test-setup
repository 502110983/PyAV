cd ffm#!/bin/bash

# PIL dependencies are a little complex, since PIL does not look in the
# right place for them.
sudo apt-get install -y libjpeg-dev libfreetype6-dev zlib1g-dev
for lib in libfreetype.so libjpeg.so libz.so
do
    if [[ ! -e /usr/lib/$lib ]]
    then
        sudo ln -s /usr/lib/$(uname -i)-linux-gnu/$lib /usr/lib/
    fi
done


pkg-config --exists libavformat
exists=$?

if [[ $exists != 0 ]]; then

    echo apt-get update
    sudo apt-get update -qq

    echo apt-get build-dep ffmpeg
    sudo apt-get build-dep -qq --fix-missing ffmpeg

    mkdir -p vendor
    cd vendor


    if [[ $LIBRARY == ffmpeg ]]; then
        
        if [[ ! "$LIBRARY_VERSION" ]]; then
            LIBRARY_VERSION=2.7
        fi

        if [[ ! -d ffmpeg-$LIBRARY_VERSION ]]; then
            wget https://ffmpeg.org/releases/ffmpeg-$LIBRARY_VERSION.tar.bz2
            tar -xjf ffmpeg-$LIBRARY_VERSION.tar.bz2
        fi
        cd ffmpeg-$LIBRARY_VERSION

        echo ./configure
        ./configure \
            --disable-static \
            --enable-shared \
            --disable-doc

        echo make
        make

        echo make install
        sudo make install


    elif [[ $LIBRARY == libav ]]; then
        
        if [[ ! "$LIBRARY_VERSION" ]]; then
            LIBRARY_VERSION=11.4
        fi

        if [[ ! -d libav-$LIBRARY_VERSION ]]; then
            wget https://libav.org/releases/libav-$LIBRARY_VERSION.tar.gz
            tar -xzf libav-$LIBRARY_VERSION.tar.gz
        fi
        cd libav-$LIBRARY_VERSION

        echo ./configure
        ./configure \
            --disable-static \
            --enable-shared \
            --disable-doc

        echo make
        make

        echo make install
        sudo make install

    fi

fi
